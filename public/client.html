<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RGB Command Center - Client</title>
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100%; width: 100%;
    background-color: #000;
    overflow: hidden;
    transition: background-color 1s ease;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    text-shadow: 0 0 8px black;
    user-select: none;
  }
  #displayText {
    position: absolute;
    top: 10%;
    width: 100%;
    text-align: center;
  }
  #displayImage {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    z-index: 0;
    display: none;
  }
</style>
</head>
<body>
<div id="displayText"></div>
<img id="displayImage" alt="Background Image" />
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const zone = urlParams.get('zone') || 'default';

  const ws = new WebSocket(`ws://${location.host}`);

  ws.addEventListener('open', () => {
    ws.send(JSON.stringify({ type: 'register', zone }));
  });

  const displayText = document.getElementById('displayText');
  const displayImage = document.getElementById('displayImage');

  let rainbowInterval = null;
  let strobeInterval = null;
  let fadeDuration = 1000;
  let transitionType = 'fade';

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    if (data.type === 'admin') {
      if (data.color) {
        clearEffects();
        transitionType = data.transition || 'cut';
        if (transitionType === 'fade') {
          document.body.style.transition = 'background-color 1s ease';
        } else {
          document.body.style.transition = 'none';
        }
        document.body.style.backgroundColor = data.color;
        displayImage.style.display = 'none';
        displayText.textContent = '';
      }
      else if (data.effect) {
        clearEffects();
        if (data.effect === 'rainbow') {
          let hue = 0;
          rainbowInterval = setInterval(() => {
            document.body.style.backgroundColor = `hsl(${hue}, 100%, 50%)`;
            hue = (hue + 5) % 360;
          }, 100);
          displayImage.style.display = 'none';
          displayText.textContent = '';
        }
        else if (data.effect === 'strobe') {
          let on = false;
          strobeInterval = setInterval(() => {
            document.body.style.backgroundColor = on ? '#fff' : '#000';
            on = !on;
          }, 100);
          displayImage.style.display = 'none';
          displayText.textContent = '';
        }
      }
      else if (data.image) {
        clearEffects();
        displayImage.src = data.image;
        displayImage.style.display = 'block';
        displayText.textContent = '';
        document.body.style.backgroundColor = '#000';
        document.body.style.transition = 'none';
      }
      else if (data.text !== undefined) {
        clearEffects();
        displayImage.style.display = 'none';
        displayText.textContent = data.text;
        document.body.style.backgroundColor = '#000';
        document.body.style.transition = 'none';
      }
    }
  };

  function clearEffects() {
    if (rainbowInterval) {
      clearInterval(rainbowInterval);
      rainbowInterval = null;
    }
    if (strobeInterval) {
      clearInterval(strobeInterval);
      strobeInterval = null;
    }
  }
</script>
</body>
</html>
